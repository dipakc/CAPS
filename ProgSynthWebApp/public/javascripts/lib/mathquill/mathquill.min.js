(function(){function y(){}function t(n){var t=vt.call(arguments,1);return function(){return n.apply(this,t)}}function l(n,t){if(!t)throw new Error("prayer failed: "+n);}function ri(n,t,i,r){function v(){h=lt;var n=u.selection?"$"+u.selection.latex()+"$":"";c.select(n)}var l=n.contents().detach(),u,o,e,h,s,p,c;if(i||n.addClass("mathquill-rendered-math"),t.jQ=n.attr(a,t.id),t.revert=function(){n.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(l)},u=t.cursor=pi(t),t.renderLatex(l.text()),o=t.textarea=f('<span class="textarea"><textarea><\/textarea><\/span>'),e=o.children(),t.selectionChanged=function(){h===lt&&(h=setTimeout(v));ui(n[0])},n.bind("selectstart.mathquill",function(n){n.target!==e[0]&&n.preventDefault();n.stopPropagation()}),p=u.blink,n.bind("mousedown.mathquill",function(t){function i(n){return u.seek(f(n.target),n.pageX,n.pageY),(u.prev!==s.prev||u.parent!==s.parent)&&u.selectFrom(s),!1}function h(n){return delete n.target,i(n)}function c(t){s=lt;u.blink=p;u.selection||(r?u.show():o.detach());n.unbind("mousemove",i);f(t.target.ownerDocument).unbind("mousemove",h).unbind("mouseup",c)}return setTimeout(function(){e.focus()}),u.blink=y,u.seek(f(t.target),t.pageX,t.pageY),s={parent:u.parent,prev:u.prev,next:u.next},r||n.prepend(o),n.mousemove(i),f(t.target.ownerDocument).mousemove(h).mouseup(c),!1}),!r){c=ii(e,{container:n});n.bind("cut paste",!1).bind("copy",v).prepend('<span class="selectable">$'+t.latex()+"$<\/span>");e.blur(function(){u.clearSelection();setTimeout(w)});function w(){o.detach()}return}c=ii(e,{container:n,key:function(n,t){u.parent.bubble("onKey",n,t)},text:function(n){u.parent.bubble("onText",n)},cut:function(n){u.selection&&setTimeout(function(){u.prepareEdit();u.parent.bubble("redraw")});n.stopPropagation()},paste:function(n){n=n.slice(0,1)==="$"&&n.slice(-1)==="$"?n.slice(1,-1):"\\text{"+n+"}";u.writeLatex(n).show()}});n.prepend(o);n.addClass("mathquill-editable");i&&n.addClass("mathquill-textbox");e.focus(function(n){u.parent||u.appendTo(t);u.parent.jQ.addClass("hasCursor");u.selection?(u.selection.jQ.removeClass("blur"),setTimeout(t.selectionChanged)):u.show();n.stopPropagation()}).blur(function(n){u.hide().parent.blur();u.selection&&u.selection.jQ.addClass("blur");n.stopPropagation()});n.bind("focus.mathquill blur.mathquill",function(n){e.trigger(n)}).blur()}function g(n,t,i){return r(ft,{ctrlSeq:n,htmlTemplate:"<"+t+" "+i+">&0<\/"+t+">"})}var f=jQuery,lt,ti="mathquill-command-id",a="mathquill-block-id",at=Math.min,wi=Math.max,vt=[].slice,r=function(n,t,i){function u(n){return typeof n=="object"}function r(n){return typeof n=="function"}function f(f,e){function o(n){var t=this;if(!(t instanceof o))return new o(arguments);n&&r(t.init)&&t.init.apply(t,n)}e===i&&(e=f,f=Object);var h=o[n]=new f,c=f[n],s,l=o.mixin=function(n){if(s={},r(n)?s=n.call(o,h,c,o,f):u(n)&&(s=n),u(s))for(var i in s)t.call(s,i)&&(h[i]=s[i]);return r(h.init)||(h.init=function(){f.apply(this,arguments)}),o};return h.constructor=o,l(e)}return f}("prototype",{}.hasOwnProperty),ii=function(){function t(t){var u=t.which||t.keyCode,f=n[u],r,i=[];return(t.ctrlKey&&i.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&i.push("Meta"),t.altKey&&i.push("Alt"),t.shiftKey&&i.push("Shift"),r=f||String.fromCharCode(u),!i.length&&!f)?r:(i.push(r),i.join("-"))}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function h(n){o=n;setTimeout(n)}function b(n){o();r.val(n);n&&r[0].select()}function k(){var n=r[0];return("selectionStart"in n)?n.selectionStart!==n.selectionEnd:!1}function c(n){var t=r.val();r.val("");t&&n(t)}function l(){v(t(u),u)}function d(n){u=n;e=null;l()}function g(n){u&&e&&l();e=n;h(nt)}function nt(){k()||c(a)}function tt(){u=e=null}function it(){r.focus();h(rt)}function rt(){c(p)}var u=null,e=null;i||(i={});var a=i.text||y,v=i.key||y,p=i.paste||y,w=i.cut||y,r=f(n),s=f(i.container||r),o=y;return s.bind("keydown keypress input keyup focusout paste",function(){o()}),s.bind({keydown:d,keypress:g,focusout:tt,cut:w,paste:it}),{select:b}}}(),e=r(function(n,t,i){function f(n,t){n=n?"'"+n+"'":"EOF";throw"Parse Error: "+t+" at "+n;}n.init=function(n){this._=n};n.parse=function(n){function t(n,t){return t}return this.skip(e)._(n,t,f)};n.or=function(n){l("or is passed a parser",n instanceof i);var t=this;return i(function(i,r,u){function f(){return n._(i,r,u)}return t._(i,r,f)})};n.then=function(n){var t=this;return i(function(r,u,f){function e(t,r){var e=n instanceof i?n:n(r);return l("a parser is returned",e instanceof i),e._(t,u,f)}return t._(r,e,f)})};n.many=function(){var n=this;return i(function(t,i){function u(n,i){return t=n,r.push(i),!0}function f(){return!1}for(var r=[];n._(t,u,f););return i(t,r)})};n.times=function(n,t){arguments.length<2&&(t=n);var r=this;return i(function(i,u,f){function c(n,t){return s.push(t),i=n,!0}function l(n,t){return h=t,i=n,!1}function a(){return!1}for(var s=[],e=!0,h,o=0;o<n;o+=1)if(e=r._(i,c,l),!e)return f(i,h);for(;o<t&&e;o+=1)e=r._(i,c,a);return u(i,s)})};n.result=function(n){return this.then(u(n))};n.atMost=function(n){return this.times(0,n)};n.atLeast=function(n){var t=this;return t.times(n).then(function(n){return t.many().map(function(t){return n.concat(t)})})};n.map=function(n){return this.then(function(t){return u(n(t))})};n.skip=function(n){return this.then(function(t){return n.result(t)})};var o=this.string=function(n){var t=n.length,r="expected '"+n+"'";return i(function(i,u,f){var e=i.slice(0,t);return e===n?u(i.slice(t),e):f(i,r)})},r=this.regex=function(n){l("regexp parser is anchored",n.toString().charAt(1)==="^");var t="expected "+n;return i(function(i,r,u){var e=n.exec(i),f;return e?(f=e[0],r(i.slice(f.length),f)):u(i,t)})},u=i.succeed=function(n){return i(function(t,i){return i(t,n)})},s=i.fail=function(n){return i(function(t,i,r){return r(t,n)})},h=i.letter=r(/^[a-z]/i),c=i.letters=r(/^[a-z]*/i),a=i.digit=r(/^[0-9]/),v=i.digits=r(/^[0-9]*/),y=i.whitespace=r(/^\s+/),p=i.optWhitespace=r(/^\s*/),w=i.any=i(function(n,t,i){return n?t(n.slice(1),n.charAt(0)):i(n,"expected any character")}),b=i.all=i(function(n,t){return t("",n)}),e=i.eof=i(function(n,t,i){return n?i(n,"expected EOF"):t(n,n)})}),yt=r(function(n){n.prev=0;n.next=0;n.parent=0;n.firstChild=0;n.lastChild=0;n.children=function(){return ot(this.firstChild,this.lastChild)};n.eachChild=function(n){return this.children().each(n)};n.foldChildren=function(n,t){return this.children().fold(n,t)};n.adopt=function(n,t,i){return ot(this,this).adopt(n,t,i),this};n.disown=function(){return ot(this,this).disown(),this}}),ot=r(function(n){function t(n,t,i){l("a parent is always present",n);l("prev is properly set up",function(){return t?t.next===i&&t.parent===n:n.firstChild===i}());l("next is properly set up",function(){return i?i.prev===t&&i.parent===n:n.lastChild===t}())}n.first=0;n.last=0;n.init=function(n,t){(l("no half-empty fragments",!n==!t),n)&&(l("first node is passed to Fragment",n instanceof yt),l("last node is passed to Fragment",t instanceof yt),l("first and last have the same parent",n.parent===t.parent),this.first=n,this.last=t)};n.adopt=function(n,i,r){var u,f,e;return(t(n,i,r),u=this,u.disowned=!1,f=u.first,!f)?this:(e=u.last,i||(n.firstChild=f),r?r.prev=e:n.lastChild=e,u.last.next=r,u.each(function(t){t.prev=i;t.parent=n;i&&(i.next=t);i=t}),u)};n.disown=function(){var r=this,n=r.first,i,u;return!n||r.disowned?r:(r.disowned=!0,i=r.last,u=n.parent,t(u,n.prev,n),t(u,i,i.next),n.prev?n.prev.next=i.next:u.firstChild=i.next,i.next?i.next.prev=n.prev:u.lastChild=n.prev,r)};n.each=function(n){var t=this,i=t.first;if(!i)return t;for(;i!==t.last.next;i=i.next)if(n.call(t,i)===!1)break;return t};n.fold=function(n,t){return this.each(function(i){n=t.call(this,n,i)}),n}}),ei=function(){var n=0;return function(){return n+=1}}(),o=r(yt,function(n){n.init=function(){this.id=ei();o[this.id]=this};n.toString=function(){return"[MathElement "+this.id+"]"};n.bubble=function(n){for(var i,r=vt.call(arguments,1),t=this;t;t=t.parent)if(i=t[n]&&t[n].apply(t,r),i===!1)break;return this};n.postOrder=function(n){var r=vt.call(arguments,1),t;typeof n=="string"&&(t=n,n=function(n){t in n&&n[t].apply(n,arguments)}),function i(t){t.eachChild(i);n(t)}(this)};n.jQ=f();n.jQadd=function(n){this.jQ=this.jQ.add(n)};this.jQize=function(n){var t=f(n);return t.find("*").andSelf().each(function(){var n=f(this),t=n.attr("mathquill-command-id"),i=n.attr("mathquill-block-id");t&&o[t].jQadd(n);i&&o[i].jQadd(n)}),t};n.finalizeInsert=function(){var n=this;n.postOrder("finalizeTree");n.postOrder("blur");n.postOrder("respace");n.next.respace&&n.next.respace();n.prev.respace&&n.prev.respace();n.postOrder("redraw");n.bubble("redraw")}}),c=r(o,function(n,t){n.init=function(n,i,r){var u=this;t.init.call(u);u.ctrlSeq||(u.ctrlSeq=n);i&&(u.htmlTemplate=i);r&&(u.textTemplate=r)};n.replaces=function(n){n.disown();this.replacedFragment=n};n.isEmpty=function(){return this.foldChildren(!0,function(n,t){return n&&t.isEmpty()})};n.parser=function(){var t=d.block,n=this;return t.times(n.numBlocks()).map(function(t){n.blocks=t;for(var i=0;i<t.length;i+=1)t[i].adopt(n,n.lastChild,0);return n})};n.createBefore=function(n){var t=this,i=t.replacedFragment;t.createBlocks();o.jQize(t.html());i&&(i.adopt(t.firstChild,0,0),i.jQ.appendTo(t.firstChild.jQ));n.jQ.before(t.jQ);n.prev=t.adopt(n.parent,n.prev,n.next);t.finalizeInsert(n);t.placeCursor(n)};n.createBlocks=function(){for(var r,n=this,i=n.numBlocks(),u=n.blocks=Array(i),t=0;t<i;t+=1)r=u[t]=p(),r.adopt(n,n.lastChild,0)};n.respace=y;n.placeCursor=function(n){n.appendTo(this.foldChildren(this.firstChild,function(n,t){return n.isEmpty()?n:t}))};n.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(n){delete o[n.id]}),this};n.numBlocks=function(){var n=this.htmlTemplate.match(/&\d+/g);return n?n.length:0};n.html=function(){var u=this,f=u.blocks,e=" mathquill-command-id="+u.id,t=u.htmlTemplate.match(/<[^<>]+>|[^<>]+/g),i,n,r;for(l("no unmatched angle brackets",t.join("")===this.htmlTemplate),i=0,n=t[0];n;i+=1,n=t[i])if(n.slice(-2)==="/>")t[i]=n.slice(0,-2)+e+"/>";else if(n.charAt(0)==="<"){l("not an unmatched top-level close tag",n.charAt(1)!=="/");t[i]=n.slice(0,-1)+e+">";r=1;do i+=1,n=t[i],l("no missing close tags",n),n.slice(0,2)==="<\/"?r-=1:n.charAt(0)==="<"&&n.slice(-2)!=="/>"&&(r+=1);while(r>0)}return t.join("").replace(/>&(\d+)/g,function(n,t){return" mathquill-block-id="+f[t].id+">"+f[t].join("html")})};n.latex=function(){return this.foldChildren(this.ctrlSeq,function(n,t){return n+"{"+(t.latex()||" ")+"}"})};n.textTemplate=[""];n.text=function(){var n=0;return this.foldChildren(this.textTemplate[n],function(t,i){n+=1;var r=i.text();return t&&this.textTemplate[n]==="("&&r[0]==="("&&r.slice(-1)===")"?t+r.slice(1,-1)+this.textTemplate[n]:t+i.text()+(this.textTemplate[n]||"")})}}),b=r(c,function(n,t){n.init=function(n,i,r){r||(r=n&&n.length>1?n.slice(1):n);t.init.call(this,n,i,[r])};n.parser=function(){return e.succeed(this)};n.numBlocks=function(){return 0};n.replaces=function(n){n.remove()};n.createBlocks=y;n.latex=function(){return this.ctrlSeq};n.text=function(){return this.textTemplate};n.placeCursor=y;n.isEmpty=function(){return!0}}),p=r(o,function(n){n.join=function(n){return this.foldChildren("",function(t,i){return t+i[n]()})};n.latex=function(){return this.join("latex")};n.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():"("+this.join("text")+")"};n.isEmpty=function(){return this.firstChild===0&&this.lastChild===0};n.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this};n.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),st=r(ot,function(n,t){n.init=function(n,i){t.init.call(this,n,i||n);this.jQ=this.fold(f(),function(n,t){return t.jQ.add(n)})};n.latex=function(){return this.fold("",function(n,t){return n+t.latex()})};n.remove=function(){return this.jQ.remove(),this.each(function(n){n.postOrder(function(n){delete o[n.id]})}),this.disown()}}),ht=r(p,function(n,t){n.latex=function(){return t.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,"$1")};n.text=function(){return this.foldChildren("",function(n,t){return n+t.text()})};n.renderLatex=function(n){var t=this.jQ;t.children().slice(1).remove();this.firstChild=this.lastChild=0;this.cursor.appendTo(this).writeLatex(n)};n.onKey=function(n,t){var i;switch(n){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":while(this.cursor.prev||this.cursor.selection)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":if(i=this.cursor.parent,i===this.cursor.root){n==="Spacebar"&&t.preventDefault();return}this.cursor.prepareMove();i.next?this.cursor.prependTo(i.next):this.cursor.insertAfter(i.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":if(i=this.cursor.parent,i===this.cursor.root){n==="Shift-Spacebar"&&t.preventDefault();return}this.cursor.prepareMove();i.prev?this.cursor.appendTo(i.prev):this.cursor.insertBefore(i.parent);break;case"Enter":break;case"End":this.cursor.prepareMove().appendTo(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().appendTo(this);break;case"Shift-End":while(this.cursor.next)this.cursor.selectRight();break;case"Ctrl-Shift-End":while(this.cursor.next||this.cursor.parent!==this)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().prependTo(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().prependTo(this);break;case"Shift-Home":while(this.cursor.prev)this.cursor.selectLeft();break;case"Ctrl-Shift-Home":while(this.cursor.prev||this.cursor.parent!==this)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor.prev)while(this.cursor.prev)this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor.next)while(this.cursor.next)this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":while(this.cursor.next||this.cursor.selection)this.cursor.deleteForward();break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().appendTo(this);this.cursor.prev;)this.cursor.selectLeft();break;default:return!1}return t.preventDefault(),!1};n.onText=function(n){return this.cursor.write(n),!1}}),pt=r(c,function(n,t){n.init=function(n){t.init.call(this,"$");this.cursor=n};n.htmlTemplate='<span class="mathquill-rendered-math">&0<\/span>';n.createBlocks=function(){this.firstChild=this.lastChild=ht();this.blocks=[this.firstChild];this.firstChild.parent=this;var n=this.firstChild.cursor=this.cursor;this.firstChild.onText=function(t){return t!=="$"||n.parent!==this?n.write(t):this.isEmpty()?n.insertAfter(this.parent).backspace().insertNew(i("\\$","$")).show():n.next?n.prev?n.write(t):n.insertBefore(this.parent):n.insertAfter(this.parent),!1}};n.latex=function(){return"$"+this.firstChild.latex()+"$"}}),oi=r(p,function(n){n.renderLatex=function(n){var t=this,s=t.cursor,r,c;t.jQ.children().slice(1).remove();t.firstChild=t.lastChild=0;s.show().appendTo(t);var l=e.regex,u=e.string,h=e.eof,a=e.all,v=u("$").then(d).skip(u("$").or(h)).map(function(n){var t=pt(s),i;return t.createBlocks(),i=t.firstChild,n.children().adopt(i,0,0),t}),y=u("\\$").result("$"),p=y.or(l(/^[^$]/)).map(i),w=v.or(p).many(),f=w.skip(h).or(a.result(!1)).parse(n);if(f){for(r=0;r<f.length;r+=1)f[r].adopt(t,t.lastChild,0);c=t.join("html");o.jQize(c).appendTo(t.jQ);this.finalizeInsert()}};n.onKey=ht.prototype.onKey;n.onText=function(n){return this.cursor.prepareEdit(),n==="$"?this.cursor.insertNew(pt(this.cursor)):this.cursor.insertNew(i(n)),!1}}),s={},n={},tt,ui=y,si=document.createElement("div"),fi=si.style,wt,bt,k,v,ut,kt,ct,dt,h,i,it,nt,u,et,w,gt;for(bt in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(bt in fi){wt=bt;break}wt?tt=function(n,t,i){n.css(wt,"scale("+t+","+i+")")}:"filter"in fi?(ui=function(n){n.className=n.className},tt=function(n,t,i){function r(){n.css("marginRight",(u.width()-1)*(t-1)/t+"px")}var u,e;t/=1+(i-1)/2;n.css("fontSize",i+"em");n.hasClass("matrixed-container")||n.addClass("matrixed-container").wrapInner('<span class="matrixed"><\/span>');u=n.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+t+",SizingMethod='auto expand')");r();e=setInterval(r);f(window).load(function(){clearTimeout(e);r()})}):tt=function(n,t,i){n.css("fontSize",i+"em")};k=r(c,function(n,t){n.init=function(n,i,r){t.init.call(this,n,"<"+i+" "+r+">&0<\/"+i+">")}});n.mathrm=t(k,"\\mathrm","span",'class="roman font"');n.mathit=t(k,"\\mathit","i",'class="font"');n.mathbf=t(k,"\\mathbf","b",'class="font"');n.mathsf=t(k,"\\mathsf","span",'class="sans-serif font"');n.mathtt=t(k,"\\mathtt","span",'class="monospace font"');n.underline=t(k,"\\underline","span",'class="non-leaf underline"');n.overline=n.bar=t(k,"\\overline","span",'class="non-leaf overline"');v=r(c,function(n,t){n.init=function(n,i,r){t.init.call(this,n,"<"+i+' class="non-leaf">&0<\/'+i+">",[r])};n.finalizeTree=function(){function n(n){var i=this.parent,t=n;do{if(t.next)return n.insertBefore(i),!1;t=t.parent.parent}while(t!==i);return n.insertAfter(i),!1}l("SupSub is only _ and ^",this.ctrlSeq==="^"||this.ctrlSeq==="_");this.ctrlSeq==="_"?(this.down=this.firstChild,this.firstChild.up=n):(this.up=this.firstChild,this.firstChild.down=n)};n.latex=function(){var n=this.firstChild.latex();return n.length===1?this.ctrlSeq+n:this.ctrlSeq+"{"+(n||" ")+"}"};n.redraw=function(){this.prev&&this.prev.respace();this.prev instanceof v||(this.respace(),!this.next||this.next instanceof v||this.next.respace())};n.respace=function(){if(this.prev.ctrlSeq==="\\int "||this.prev instanceof v&&this.prev.ctrlSeq!=this.ctrlSeq&&this.prev.prev&&this.prev.prev.ctrlSeq==="\\int "?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this.prev instanceof v&&this.prev.ctrlSeq!=this.ctrlSeq&&!this.prev.respaced,this.respaced){var n=+this.jQ.css("fontSize").slice(0,-2),t=this.prev.jQ.outerWidth(),i=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&this.ctrlSeq==="_"?-.25:0)-t/n+"em",marginRight:.1-at(i,t)/n+"em"})}else this.limit&&this.ctrlSeq==="_"?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this.next instanceof v&&this.next.respace(),this}});n.subscript=n._=t(v,"_","sub","_");n.superscript=n.supscript=n["^"]=t(v,"^","sup","**");var hi=n.frac=n.dfrac=n.cfrac=n.fraction=r(c,function(n){n.ctrlSeq="\\frac";n.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0<\/span><span class="denominator">&1<\/span><span style="display:inline-block;width:0">&nbsp;<\/span><\/span>';n.textTemplate=["(","/",")"];n.finalizeTree=function(){this.up=this.lastChild.up=this.firstChild;this.down=this.firstChild.down=this.lastChild}}),ci=n.over=s["/"]=r(hi,function(n,t){n.createBefore=function(n){if(!this.replacedFragment){for(var i=n.prev;i&&!(i instanceof u||i instanceof ft||i instanceof w);)i=i.prev;i instanceof w&&i.next instanceof v&&(i=i.next,i.next instanceof v&&i.next.ctrlSeq!=i.ctrlSeq&&(i=i.next));i!==n.prev&&(this.replaces(st(i.next||n.parent.firstChild,n.prev)),n.prev=i)}t.createBefore.call(this,n)}}),li=n.sqrt=n["√"]=r(c,function(n,t){n.ctrlSeq="\\sqrt";n.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;<\/span><span class="non-leaf sqrt-stem">&0<\/span><\/span>';n.textTemplate=["sqrt(",")"];n.parser=function(){return d.optBlock.then(function(n){return d.block.map(function(t){var i=ai();return i.blocks=[n,t],n.adopt(i,0,0),t.adopt(i,n,0),i})}).or(t.parser.call(this))};n.redraw=function(){var n=this.lastChild.jQ;tt(n.prev(),1,n.innerHeight()/+n.css("fontSize").slice(0,-2)-.1)}}),ai=n.nthroot=r(li,function(n){n.htmlTemplate='<sup class="nthroot non-leaf">&0<\/sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;<\/span><span class="sqrt-stem non-leaf">&1<\/span><\/span>';n.textTemplate=["sqrt[","](",")"];n.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"}}),rt=r(c,function(n,t){n.init=function(n,i,r,u){t.init.call(this,"\\left"+r,'<span class="non-leaf"><span class="scaled paren">'+n+'<\/span><span class="non-leaf">&0<\/span><span class="scaled paren">'+i+"<\/span><\/span>",[n,i]);this.end="\\right"+u};n.jQadd=function(){t.jQadd.apply(this,arguments);var n=this.jQ;this.bracketjQs=n.children(":first").add(n.children(":last"))};n.latex=function(){return this.ctrlSeq+this.firstChild.latex()+this.end};n.redraw=function(){var n=this.firstChild.jQ,t=n.outerHeight()/+n.css("fontSize").slice(0,-2);tt(this.bracketjQs,at(1+.2*(t-1),1.2),1.05*t)}});n.left=r(c,function(n){n.parser=function(){var n=e.regex,i=e.string,n=e.regex,r=e.succeed,u=d.block,t=e.optWhitespace;return t.then(n(/^(?:[([|]|\\\{)/)).then(function(u){u.charAt(0)==="\\"&&(u=u.slice(1));var f=s[u]();return d.map(function(n){f.blocks=[n];n.adopt(f,0,0)}).then(i("\\right")).skip(t).then(n(/^(?:[\])|]|\\\})/)).then(function(n){return n.slice(-1)!==f.end.slice(-1)?e.fail("open doesn't match close"):r(f)})})}});n.right=r(c,function(n){n.parser=function(){return e.fail("unmatched \\right")}});n.lbrace=s["{"]=t(rt,"{","}","\\{","\\}");n.langle=n.lang=t(rt,"&lang;","&rang;","\\langle ","\\rangle ");ut=r(rt,function(n,t){n.createBefore=function(n){n.next||!n.parent.parent||n.parent.parent.end!==this.end||this.replacedFragment?t.createBefore.call(this,n):n.insertAfter(n.parent.parent)};n.placeCursor=function(n){this.firstChild.blur();n.insertAfter(this)}});n.rbrace=s["}"]=t(ut,"{","}","\\{","\\}");n.rangle=n.rang=t(ut,"&lang;","&rang;","\\langle ","\\rangle ");kt=function(n,t){n.init=function(n,i){t.init.call(this,n,i,n,i)}};ct=r(rt,kt);n.lparen=s["("]=t(ct,"(",")");n.lbrack=n.lbracket=s["["]=t(ct,"[","]");dt=r(ut,kt);n.rparen=s[")"]=t(dt,"(",")");n.rbrack=n.rbracket=s["]"]=t(dt,"[","]");var bi=n.lpipe=n.rpipe=s["|"]=r(ct,function(n,t){n.init=function(){t.init.call(this,"|","|")};n.createBefore=ut.prototype.createBefore}),ft=s.$=n.text=n.textnormal=n.textrm=n.textup=n.textmd=r(c,function(n,t){n.ctrlSeq="\\text";n.htmlTemplate='<span class="text">&0<\/span>';n.replaces=function(n){n instanceof st?this.replacedText=n.remove().jQ.text():typeof n=="string"&&(this.replacedText=n)};n.textTemplate=['"','"'];n.parser=function(){var n=e.string,t=e.regex,r=e.optWhitespace;return r.then(n("{")).then(t(/^[^}]*/)).skip(n("}")).map(function(n){var r=ft(),u,t,f;for(r.createBlocks(),u=r.firstChild,t=0;t<n.length;t+=1)f=i(n.charAt(t)),f.adopt(u,u.lastChild,0);return r})};n.createBlocks=function(){this.firstChild=this.lastChild=vi();this.blocks=[this.firstChild];this.firstChild.parent=this};n.finalizeInsert=function(){this.firstChild.blur=function(){return delete this.blur,this};t.finalizeInsert.call(this)};n.createBefore=function(n){if(t.createBefore.call(this,this.cursor=n),this.replacedText)for(var i=0;i<this.replacedText.length;i+=1)this.write(this.replacedText.charAt(i))};n.write=function(n){this.cursor.insertNew(i(n))};n.onKey=function(n){if(!this.cursor.selection&&(n==="Backspace"&&!this.cursor.prev||n==="Del"&&!this.cursor.next))return this.isEmpty()&&this.cursor.insertAfter(this),!1};n.onText=function(n){if(this.cursor.prepareEdit(),n!=="$")this.write(n);else if(this.isEmpty())this.cursor.insertAfter(this).backspace().insertNew(i("\\$","$"));else if(this.cursor.next)if(this.cursor.prev){var t=ft(st(this.cursor.next,this.firstChild.lastChild));t.placeCursor=function(n){this.prev=0;delete this.placeCursor;this.placeCursor(n)};t.firstChild.focus=function(){return this};this.cursor.insertAfter(this).insertNew(t);t.prev=this;this.cursor.insertBefore(t);delete t.firstChild.focus}else this.cursor.insertBefore(this);else this.cursor.insertAfter(this);return!1}}),vi=r(p,function(n,t){n.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var t=this.parent,n=t.cursor;n.parent===this?this.jQ.addClass("empty"):(n.hide(),t.remove(),n.next===t?n.next=t.next:n.prev===t&&(n.prev=t.prev),n.show().parent.bubble("redraw"))}return this};n.focus=function(){var n,i;if(t.focus.call(this),n=this.parent,n.next.ctrlSeq===n.ctrlSeq){var u=this,i=n.cursor,r=n.next.firstChild;r.eachChild(function(n){n.parent=u;n.jQ.appendTo(u.jQ)});this.lastChild?this.lastChild.next=r.firstChild:this.firstChild=r.firstChild;r.firstChild.prev=this.lastChild;this.lastChild=r.lastChild;r.parent.remove();i.prev?i.insertAfter(i.prev):i.prependTo(this);i.parent.bubble("redraw")}else n.prev.ctrlSeq===n.ctrlSeq&&(i=n.cursor,i.prev?n.prev.firstChild.focus():i.appendTo(n.prev.firstChild));return this}});n.em=n.italic=n.italics=n.emph=n.textit=n.textsl=g("\\textit","i",'class="text"');n.strong=n.bold=n.textbf=g("\\textbf","b",'class="text"');n.sf=n.textsf=g("\\textsf","span",'class="sans-serif text"');n.tt=n.texttt=g("\\texttt","span",'class="monospace text"');n.textsc=g("\\textsc","span",'style="font-variant:small-caps" class="text"');n.uppercase=g("\\uppercase","span",'style="text-transform:uppercase" class="text"');n.lowercase=g("\\lowercase","span",'style="text-transform:lowercase" class="text"');var ki=s["\\"]=r(c,function(n,t){n.ctrlSeq="\\";n.replaces=function(n){this._replacedFragment=n.disown();this.isEmpty=function(){return!1}};n.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0<\/span><\/span>';n.textTemplate=["\\"];n.createBlocks=function(){t.createBlocks.call(this);this.firstChild.focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this};this.firstChild.blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}};n.createBefore=function(n){if(t.createBefore.call(this,n),this.cursor=n.appendTo(this.firstChild),this._replacedFragment){var i=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(n){return f(n.target=i).trigger(n),!1}).insertBefore(this.jQ).add(this.jQ)}};n.latex=function(){return"\\"+this.firstChild.latex()+" "};n.onKey=function(n,t){if(n==="Tab"||n==="Enter"||n==="Spacebar")return this.renderCommand(),t.preventDefault(),!1};n.onText=function(n){return n.match(/[a-z]/i)?(this.cursor.prepareEdit(),this.cursor.insertNew(i(n)),!1):(this.renderCommand(),n==="\\"&&this.firstChild.isEmpty()?!1:void 0)};n.renderCommand=function(){this.jQ=this.jQ.last();this.remove();this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var n=this.firstChild.latex();n||(n="backslash");this.cursor.insertCmd(n,this._replacedFragment)}}),yi=n.binom=n.binomial=r(c,function(n){n.ctrlSeq="\\binom";n.htmlTemplate='<span class="paren scaled">(<\/span><span class="non-leaf"><span class="array non-leaf"><span>&0<\/span><span>&1<\/span><\/span><\/span><span class="paren scaled">)<\/span>';n.textTemplate=["choose(",",",")"];n.redraw=function(){var n=this.jQ.eq(1),t=n.outerHeight()/+n.css("fontSize").slice(0,-2),i=this.jQ.filter(".paren");tt(i,at(1+.2*(t-1),1.2),1.05*t)}}),di=n.choose=r(yi,function(n){n.createBefore=ci.prototype.createBefore}),gi=n.vector=r(c,function(n,t){n.ctrlSeq="\\vector";n.htmlTemplate='<span class="array"><span>&0<\/span><\/span>';n.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(n,t){return n.push(t.latex()),n}).join("\\\\")+"\\end{matrix}"};n.text=function(){return"["+this.foldChildren([],function(n,t){return n.push(t.text()),n}).join()+"]"};n.createBefore=function(n){t.createBefore.call(this,this.cursor=n)};n.onKey=function(n,t){var i=this.cursor.parent,r;if(i.parent===this){if(n==="Enter")return r=p(),r.parent=this,r.jQ=f("<span><\/span>").attr(a,r.id).insertAfter(i.jQ),i.next?i.next.prev=r:this.lastChild=r,r.next=i.next,i.next=r,r.prev=i,this.bubble("redraw").cursor.appendTo(r),t.preventDefault(),!1;if(n!=="Tab"||i.next){if(t.which===8){if(i.isEmpty())return i.prev?(this.cursor.appendTo(i.prev),i.prev.next=i.next):(this.cursor.insertBefore(this),this.firstChild=i.next),i.next?i.next.prev=i.prev:this.lastChild=i.prev,i.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),t.preventDefault(),!1;if(!this.cursor.prev)return t.preventDefault(),!1}}else return i.isEmpty()?i.prev?(this.cursor.insertAfter(this),delete i.prev.next,this.lastChild=i.prev,i.jQ.remove(),this.bubble("redraw"),t.preventDefault(),!1):void 0:(r=p(),r.parent=this,r.jQ=f("<span><\/span>").attr(a,r.id).appendTo(this.jQ),this.lastChild=r,i.next=r,r.prev=i,this.bubble("redraw").cursor.appendTo(r),t.preventDefault(),!1)}}});n.editable=r(pt,function(n,t){n.init=function(){c.prototype.init.call(this,"\\editable")};n.jQadd=function(){var n=this,i,r;t.jQadd.apply(n,arguments);i=n.firstChild.disown();r=n.jQ.children().detach();n.firstChild=n.lastChild=ht();n.blocks=[n.firstChild];n.firstChild.parent=n;ri(n.jQ,n.firstChild,!1,!0);n.cursor=n.firstChild.cursor;i.children().adopt(n.firstChild,0,0);r.appendTo(n.firstChild.jQ);n.firstChild.cursor.appendTo(n.firstChild)};n.latex=function(){return this.firstChild.latex()};n.text=function(){return this.firstChild.text()}});n.f=t(b,"f",'<var class="florin">&fnof;<\/var><span style="display:inline-block;width:0">&nbsp;<\/span>');h=r(b,function(n,t){n.init=function(n,i){t.init.call(this,n,"<var>"+(i||n)+"<\/var>")};n.text=function(){var n=this.ctrlSeq;return!this.prev||this.prev instanceof h||this.prev instanceof u||(n="*"+n),!this.next||this.next instanceof u||this.next.ctrlSeq==="^"||(n+="*"),n}});i=r(b,function(n,t){n.init=function(n,i){t.init.call(this,n,"<span>"+(i||n)+"<\/span>")}});s[" "]=t(i,"\\:"," ");s["~"]=t(i,"\\:"," ");n.prime=s["'"]=t(i,"'","&prime;");it=r(b,function(n,t){n.init=function(n,i){t.init.call(this,n,'<span class="nonSymbola">'+(i||n)+"<\/span>")}});n["@"]=it;n["&"]=t(it,"\\&","&amp;");n["%"]=t(it,"\\%","%");n.alpha=n.beta=n.gamma=n.delta=n.zeta=n.eta=n.theta=n.iota=n.kappa=n.mu=n.nu=n.xi=n.rho=n.sigma=n.tau=n.chi=n.psi=n.omega=r(h,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}});n.phi=t(h,"\\phi ","&#981;");n.phiv=n.varphi=t(h,"\\varphi ","&phi;");n.epsilon=t(h,"\\epsilon ","&#1013;");n.epsiv=n.varepsilon=t(h,"\\varepsilon ","&epsilon;");n.piv=n.varpi=t(h,"\\varpi ","&piv;");n.sigmaf=n.sigmav=n.varsigma=t(h,"\\varsigma ","&sigmaf;");n.thetav=n.vartheta=n.thetasym=t(h,"\\vartheta ","&thetasym;");n.upsilon=n.upsi=t(h,"\\upsilon ","&upsilon;");n.gammad=n.Gammad=n.digamma=t(h,"\\digamma ","&#989;");n.kappav=n.varkappa=t(h,"\\varkappa ","&#1008;");n.rhov=n.varrho=t(h,"\\varrho ","&#1009;");n.pi=n["π"]=t(it,"\\pi ","&pi;");n.lambda=t(it,"\\lambda ","&lambda;");n.Upsilon=n.Upsi=n.upsih=n.Upsih=t(b,"\\Upsilon ",'<var style="font-family: serif">&upsih;<\/var>');n.Gamma=n.Delta=n.Theta=n.Lambda=n.Xi=n.Pi=n.Sigma=n.Phi=n.Psi=n.Omega=n.forall=r(i,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}});nt=r(c,function(n){n.init=function(n){this.latex=n};n.createBefore=function(n){n.writeLatex(this.latex)};n.parser=function(){var n=d.parse(this.latex).children();return e.succeed(n)}});n["¹"]=t(nt,"^1");n["²"]=t(nt,"^2");n["³"]=t(nt,"^3");n["¼"]=t(nt,"\\frac14");n["½"]=t(nt,"\\frac12");n["¾"]=t(nt,"\\frac34");u=r(b,function(n,t){n.init=function(n,i,r){t.init.call(this,n,'<span class="binary-operator">'+i+"<\/span>",r)}});et=r(u,function(n){n.init=i.prototype.init;n.respace=function(){return this.jQ[0].className=this.prev?this.prev instanceof u&&this.next&&!(this.next instanceof u)?"unary-operator":"binary-operator":"",this}});n["+"]=t(et,"+","+");n["–"]=n["-"]=t(et,"-","&minus;");n["±"]=n.pm=n.plusmn=n.plusminus=t(et,"\\pm ","&plusmn;");n.mp=n.mnplus=n.minusplus=t(et,"\\mp ","&#8723;");s["*"]=n.sdot=n.cdot=t(u,"\\cdot ","&middot;");n["="]=t(u,"=","=");n["<"]=t(u,"<","&lt;");n[">"]=t(u,">","&gt;");n.notin=n.sim=n.cong=n.equiv=n.oplus=n.otimes=r(u,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","&"+n+";")}});n.times=t(u,"\\times ","&times;","[x]");n["÷"]=n.div=n.divide=n.divides=t(u,"\\div ","&divide;","[/]");n["≠"]=n.ne=n.neq=t(u,"\\ne ","&ne;");n.ast=n.star=n.loast=n.lowast=t(u,"\\ast ","&lowast;");n.therefor=n.therefore=t(u,"\\therefore ","&there4;");n.cuz=n.because=t(u,"\\because ","&#8757;");n.prop=n.propto=t(u,"\\propto ","&prop;");n["≈"]=n.asymp=n.approx=t(u,"\\approx ","&asymp;");n.lt=t(u,"<","&lt;");n.gt=t(u,">","&gt;");n["≤"]=n.le=n.leq=t(u,"\\le ","&le;");n["≥"]=n.ge=n.geq=t(u,"\\ge ","&ge;");n.isin=n["in"]=t(u,"\\in ","&isin;");n.ni=n.contains=t(u,"\\ni ","&ni;");n.notni=n.niton=n.notcontains=n.doesnotcontain=t(u,"\\not\\ni ","&#8716;");n.sub=n.subset=t(u,"\\subset ","&sub;");n.sup=n.supset=n.superset=t(u,"\\supset ","&sup;");n.nsub=n.notsub=n.nsubset=n.notsubset=t(u,"\\not\\subset ","&#8836;");n.nsup=n.notsup=n.nsupset=n.notsupset=n.nsuperset=n.notsuperset=t(u,"\\not\\supset ","&#8837;");n.sube=n.subeq=n.subsete=n.subseteq=t(u,"\\subseteq ","&sube;");n.supe=n.supeq=n.supsete=n.supseteq=n.supersete=n.superseteq=t(u,"\\supseteq ","&supe;");n.nsube=n.nsubeq=n.notsube=n.notsubeq=n.nsubsete=n.nsubseteq=n.notsubsete=n.notsubseteq=t(u,"\\not\\subseteq ","&#8840;");n.nsupe=n.nsupeq=n.notsupe=n.notsupeq=n.nsupsete=n.nsupseteq=n.notsupsete=n.notsupseteq=n.nsupersete=n.nsuperseteq=n.notsupersete=n.notsuperseteq=t(u,"\\not\\supseteq ","&#8841;");w=r(b,function(n,t){n.init=function(n,i){t.init.call(this,n,"<big>"+i+"<\/big>")}});n["∑"]=n.sum=n.summation=t(w,"\\sum ","&sum;");n.Sum=t(w,"\\Sum ","&sum;&nbsp;");n["∏"]=n.prod=n.product=t(w,"\\prod ","&prod;");n.coprod=n.coproduct=t(w,"\\coprod ","&#8720;");n["∫"]=n.int=n.integral=t(w,"\\int ","&int;");n.Max=t(w,"\\Max ","Max&nbsp;");n.Count=t(w,"\\Count ","Count&nbsp;");n.naturals=n.Naturals=t(i,"\\mathbb{N}","&#8469;");n.primes=n.Primes=n.projective=n.Projective=n.probability=n.Probability=t(i,"\\mathbb{P}","&#8473;");n.integers=n.Integers=t(i,"\\mathbb{Z}","&#8484;");n.rationals=n.Rationals=t(i,"\\mathbb{Q}","&#8474;");n.reals=n.Reals=t(i,"\\mathbb{R}","&#8477;");n.complex=n.Complex=n.complexes=n.Complexes=n.complexplane=n.Complexplane=n.ComplexPlane=t(i,"\\mathbb{C}","&#8450;");n.Hamiltonian=n.quaternions=n.Quaternions=t(i,"\\mathbb{H}","&#8461;");n.quad=n.emsp=t(i,"\\quad ","    ");n.qquad=t(i,"\\qquad ","        ");n.diamond=t(i,"\\diamond ","&#9671;");n.bigtriangleup=t(i,"\\bigtriangleup ","&#9651;");n.ominus=t(i,"\\ominus ","&#8854;");n.uplus=t(i,"\\uplus ","&#8846;");n.bigtriangledown=t(i,"\\bigtriangledown ","&#9661;");n.sqcap=t(i,"\\sqcap ","&#8851;");n.triangleleft=t(i,"\\triangleleft ","&#8882;");n.sqcup=t(i,"\\sqcup ","&#8852;");n.triangleright=t(i,"\\triangleright ","&#8883;");n.odot=t(i,"\\odot ","&#8857;");n.bigcirc=t(i,"\\bigcirc ","&#9711;");n.dagger=t(i,"\\dagger ","&#0134;");n.ddagger=t(i,"\\ddagger ","&#135;");n.wr=t(i,"\\wr ","&#8768;");n.amalg=t(i,"\\amalg ","&#8720;");n.models=t(i,"\\models ","&#8872;");n.prec=t(i,"\\prec ","&#8826;");n.succ=t(i,"\\succ ","&#8827;");n.preceq=t(i,"\\preceq ","&#8828;");n.succeq=t(i,"\\succeq ","&#8829;");n.simeq=t(i,"\\simeq ","&#8771;");n.mid=t(i,"\\mid ","&#8739;");n.ll=t(i,"\\ll ","&#8810;");n.gg=t(i,"\\gg ","&#8811;");n.parallel=t(i,"\\parallel ","&#8741;");n.bowtie=t(i,"\\bowtie ","&#8904;");n.sqsubset=t(i,"\\sqsubset ","&#8847;");n.sqsupset=t(i,"\\sqsupset ","&#8848;");n.smile=t(i,"\\smile ","&#8995;");n.sqsubseteq=t(i,"\\sqsubseteq ","&#8849;");n.sqsupseteq=t(i,"\\sqsupseteq ","&#8850;");n.doteq=t(i,"\\doteq ","&#8784;");n.frown=t(i,"\\frown ","&#8994;");n.vdash=t(i,"\\vdash ","&#8870;");n.dashv=t(i,"\\dashv ","&#8867;");n.longleftarrow=t(i,"\\longleftarrow ","&#8592;");n.longrightarrow=t(i,"\\longrightarrow ","&#8594;");n.Longleftarrow=t(i,"\\Longleftarrow ","&#8656;");n.Longrightarrow=t(i,"\\Longrightarrow ","&#8658;");n.longleftrightarrow=t(i,"\\longleftrightarrow ","&#8596;");n.updownarrow=t(i,"\\updownarrow ","&#8597;");n.Longleftrightarrow=t(i,"\\Longleftrightarrow ","&#8660;");n.Updownarrow=t(i,"\\Updownarrow ","&#8661;");n.mapsto=t(i,"\\mapsto ","&#8614;");n.nearrow=t(i,"\\nearrow ","&#8599;");n.hookleftarrow=t(i,"\\hookleftarrow ","&#8617;");n.hookrightarrow=t(i,"\\hookrightarrow ","&#8618;");n.searrow=t(i,"\\searrow ","&#8600;");n.leftharpoonup=t(i,"\\leftharpoonup ","&#8636;");n.rightharpoonup=t(i,"\\rightharpoonup ","&#8640;");n.swarrow=t(i,"\\swarrow ","&#8601;");n.leftharpoondown=t(i,"\\leftharpoondown ","&#8637;");n.rightharpoondown=t(i,"\\rightharpoondown ","&#8641;");n.nwarrow=t(i,"\\nwarrow ","&#8598;");n.ldots=t(i,"\\ldots ","&#8230;");n.cdots=t(i,"\\cdots ","&#8943;");n.vdots=t(i,"\\vdots ","&#8942;");n.ddots=t(i,"\\ddots ","&#8944;");n.surd=t(i,"\\surd ","&#8730;");n.triangle=t(i,"\\triangle ","&#9653;");n.ell=t(i,"\\ell ","&#8467;");n.top=t(i,"\\top ","&#8868;");n.flat=t(i,"\\flat ","&#9837;");n.natural=t(i,"\\natural ","&#9838;");n.sharp=t(i,"\\sharp ","&#9839;");n.wp=t(i,"\\wp ","&#8472;");n.bot=t(i,"\\bot ","&#8869;");n.clubsuit=t(i,"\\clubsuit ","&#9827;");n.diamondsuit=t(i,"\\diamondsuit ","&#9826;");n.heartsuit=t(i,"\\heartsuit ","&#9825;");n.spadesuit=t(i,"\\spadesuit ","&#9824;");n.oint=t(i,"\\oint ","&#8750;");n.bigcap=t(i,"\\bigcap ","&#8745;");n.bigcup=t(i,"\\bigcup ","&#8746;");n.bigsqcup=t(i,"\\bigsqcup ","&#8852;");n.bigvee=t(i,"\\bigvee ","&#8744;");n.bigwedge=t(i,"\\bigwedge ","&#8743;");n.bigodot=t(i,"\\bigodot ","&#8857;");n.bigotimes=t(i,"\\bigotimes ","&#8855;");n.bigoplus=t(i,"\\bigoplus ","&#8853;");n.biguplus=t(i,"\\biguplus ","&#8846;");n.lfloor=t(i,"\\lfloor ","&#8970;");n.rfloor=t(i,"\\rfloor ","&#8971;");n.lceil=t(i,"\\lceil ","&#8968;");n.rceil=t(i,"\\rceil ","&#8969;");n.slash=t(i,"\\slash ","&#47;");n.opencurlybrace=t(i,"\\opencurlybrace ","&#123;");n.closecurlybrace=t(i,"\\closecurlybrace ","&#125;");n.caret=t(i,"\\caret ","^");n.underscore=t(i,"\\underscore ","_");n.backslash=t(i,"\\backslash ","\\");n.vert=t(i,"|");n.perp=n.perpendicular=t(i,"\\perp ","&perp;");n.nabla=n.del=t(i,"\\nabla ","&nabla;");n.hbar=t(i,"\\hbar ","&#8463;");n.AA=n.Angstrom=n.angstrom=t(i,"\\text\\AA ","&#8491;");n.ring=n.circ=n.circle=t(i,"\\circ ","&#8728;");n.bull=n.bullet=t(i,"\\bullet ","&bull;");n.setminus=n.smallsetminus=t(i,"\\setminus ","&#8726;");n.not=n["¬"]=n.neg=t(i,"\\neg ","&not;");n["…"]=n.dots=n.ellip=n.hellip=n.ellipsis=n.hellipsis=t(i,"\\dots ","&hellip;");n.converges=n.darr=n.dnarr=n.dnarrow=n.downarrow=t(i,"\\downarrow ","&darr;");n.dArr=n.dnArr=n.dnArrow=n.Downarrow=t(i,"\\Downarrow ","&dArr;");n.diverges=n.uarr=n.uparrow=t(i,"\\uparrow ","&uarr;");n.uArr=n.Uparrow=t(i,"\\Uparrow ","&uArr;");n.to=t(u,"\\to ","&rarr;");n.rarr=n.rightarrow=t(i,"\\rightarrow ","&rarr;");n.implies=t(u,"\\Rightarrow ","&rArr;");n.rArr=n.Rightarrow=t(i,"\\Rightarrow ","&rArr;");n.gets=t(u,"\\gets ","&larr;");n.larr=n.leftarrow=t(i,"\\leftarrow ","&larr;");n.impliedby=t(u,"\\Leftarrow ","&lArr;");n.lArr=n.Leftarrow=t(i,"\\Leftarrow ","&lArr;");n.harr=n.lrarr=n.leftrightarrow=t(i,"\\leftrightarrow ","&harr;");n.iff=t(u,"\\Leftrightarrow ","&hArr;");n.hArr=n.lrArr=n.Leftrightarrow=t(i,"\\Leftrightarrow ","&hArr;");n.Re=n.Real=n.real=t(i,"\\Re ","&real;");n.Im=n.imag=n.image=n.imagin=n.imaginary=n.Imaginary=t(i,"\\Im ","&image;");n.part=n.partial=t(i,"\\partial ","&part;");n.inf=n.infin=n.infty=n.infinity=t(i,"\\infty ","&infin;");n.alef=n.alefsym=n.aleph=n.alephsym=t(i,"\\aleph ","&alefsym;");n.xist=n.xists=n.exist=n.exists=t(i,"\\exists ","&exist;");n.and=n.land=n.wedge=t(i,"\\wedge ","&and;");n.or=n.lor=n.vee=t(i,"\\vee ","&or;");n.o=n.O=n.empty=n.emptyset=n.oslash=n.Oslash=n.nothing=n.varnothing=t(u,"\\varnothing ","&empty;");n.cup=n.union=t(u,"\\cup ","&cup;");n.cap=n.intersect=n.intersection=t(u,"\\cap ","&cap;");n.deg=n.degree=t(i,"^\\circ ","&deg;");n.ang=n.angle=t(i,"\\angle ","&ang;");gt=r(b,function(n,t){n.init=function(n){t.init.call(this,"\\"+n+" ","<span>"+n+"<\/span>")};n.respace=function(){this.jQ[0].className=this.next instanceof v||this.next instanceof rt?"":"non-italicized-function"}});n.ln=n.lg=n.log=n.span=n.proj=n.det=n.dim=n.min=n.max=n.mod=n.lcm=n.gcd=n.gcf=n.hcf=n.lim=gt,function(){var t=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var i in t)n[t[i]]=n[t[i]+"h"]=n["a"+t[i]]=n["arc"+t[i]]=n["a"+t[i]+"h"]=n["arc"+t[i]+"h"]=gt}();var d=function(){function a(n){var t=p();return n.adopt(t,0,0),t}function s(n){for(var t=n[0]||p(),i=1;i<n.length;i+=1)n[i].children().adopt(t,t.lastChild,0);return t}var t=e.string,r=e.regex,v=e.letter,y=e.any,u=e.optWhitespace,w=e.succeed,c=e.fail,b=v.map(h),k=r(/^[^${}\\_^]/).map(i),d=r(/^[^\\]/).or(t("\\").then(r(/^[a-z]+/i).or(r(/^\s+/).result(" ")).or(y))).then(function(t){var i=n[t];return i?i(t).parser():c("unknown command: \\"+t)}),g=d.or(b).or(k),nt=t("{").then(function(){return l}).skip(t("}")),f=u.then(nt.or(g.map(a))),l=f.many().map(s).skip(u),tt=t("[").then(f.then(function(n){return n.join("latex")!=="]"?w(n):c()}).many().map(s).skip(u)).skip(t("]")),o=l;return o.block=f,o.optBlock=tt,o}(),pi=r(function(t){function c(n,t){var r,i,f,e;if(n.next[t])n.prependTo(n.next[t]);else if(n.prev[t])n.appendTo(n.prev[t]);else{r=n.parent;do{if(i=r[t],i&&(typeof i=="function"&&(i=r[t](n)),i===!1||i instanceof p)){n.upDownCache[r.id]={parent:n.parent,prev:n.prev,next:n.next};i instanceof p&&(f=n.upDownCache[i.id],f?f.next?n.insertBefore(f.next):n.appendTo(f.parent):(e=u(n).left,n.appendTo(i),n.seekHoriz(e,i)));break}r=r.parent.parent}while(r)}return n.clearSelection().show()}function u(n){var t=n.jQ.removeClass("cursor").offset();return n.jQ.addClass("cursor"),t}function r(n){n.upDownCache={}}t.init=function(n){this.parent=this.root=n;var t=this.jQ=this._jQ=f('<span class="cursor">&zwj;<\/span>');this.blink=function(){t.toggleClass("blink")};this.upDownCache={}};t.prev=0;t.next=0;t.parent=0;t.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.first.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this};t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=f(),this};t.insertAt=function(n,t,i){var r=this.parent;this.parent=n;this.prev=t;this.next=i;r.blur()};t.insertBefore=function(n){return this.insertAt(n.parent,n.prev,n),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(n.jQ.first()),this};t.insertAfter=function(n){return this.insertAt(n.parent,n,n.next),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(n.jQ.last()),this};t.prependTo=function(n){return this.insertAt(n,0,n.firstChild),n.textarea?this.jQ.insertAfter(n.textarea):this.jQ.prependTo(n.jQ),n.focus(),this};t.appendTo=function(n){return this.insertAt(n,n.lastChild,0),this.jQ.appendTo(n.jQ),n.focus(),this};t.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this};t.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this};t.moveLeftWithin=function(n){if(this.prev)this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft();else{if(this.parent===n)return;this.parent.prev?this.appendTo(this.parent.prev):this.insertBefore(this.parent.parent)}};t.moveRightWithin=function(n){if(this.next)this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight();else{if(this.parent===n)return;this.parent.next?this.prependTo(this.parent.next):this.insertAfter(this.parent.parent)}};t.moveLeft=function(){return r(this),this.selection?this.insertBefore(this.selection.first).clearSelection():this.moveLeftWithin(this.root),this.show()};t.moveRight=function(){return r(this),this.selection?this.insertAfter(this.selection.last).clearSelection():this.moveRightWithin(this.root),this.show()};t.moveUp=function(){return c(this,"up")};t.moveDown=function(){return c(this,"down")};t.seek=function(n,t){r(this);var u,f,i=this.clearSelection().show();return n.hasClass("empty")?(i.prependTo(o[n.attr(a)]),i):(u=o[n.attr(ti)],u instanceof b)?(n.outerWidth()>2*(t-n.offset().left)?i.insertBefore(u):i.insertAfter(u),i):(u||(f=o[n.attr(a)],f||(n=n.parent(),u=o[n.attr(ti)],u||(f=o[n.attr(a)],f||(f=i.root)))),u?i.insertAfter(u):i.appendTo(f),i.seekHoriz(t,i.root))};t.seekHoriz=function(n,t){var i=this,r=u(i).left-n,f;do i.moveLeftWithin(t),f=r,r=u(i).left-n;while(r>0&&(i.prev||i.parent!==t));return-r>f&&i.moveRightWithin(t),i};t.writeLatex=function(n){var t=this;r(t);t.show().deleteSelection();var u=e.all,f=e.eof,i=d.skip(f).or(u.result(!1)).parse(n);return i&&(i.children().adopt(t.parent,t.prev,t.next),o.jQize(i.join("html")).insertBefore(t.jQ),t.prev=i.lastChild,i.finalizeInsert(),t.parent.bubble("redraw")),this.hide()};t.write=function(n){return r(this),this.show().insertCh(n)};t.insertCh=function(t){var r;return r=t.match(/^[a-eg-zA-Z]$/)?h(t):(r=s[t]||n[t])?r(t):i(t),this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,r.replaces(this.selection),delete this.selection),this.insertNew(r)};t.insertNew=function(n){return n.createBefore(this),this};t.insertCmd=function(t,i){var r=n[t];return r?(r=r(t),i&&r.replaces(i),this.insertNew(r)):(r=ft(),r.replaces(t),r.firstChild.focus=function(){return delete this.focus,this},this.insertNew(r).insertAfter(r),i&&i.remove()),this};t.unwrapGramp=function(){var n=this.parent.parent,t=n.parent,r=n.next,u=this,i=n.prev;if(n.disown().eachChild(function(u){u.isEmpty()||(u.children().adopt(t,i,r).each(function(t){t.jQ.insertBefore(n.jQ.first())}),i=u.lastChild)}),!this.next)if(this.prev)this.next=this.prev.next;else while(!this.next)if(this.parent=this.parent.next,this.parent)this.next=this.parent.firstChild;else{this.next=n.next;this.parent=t;break}this.next?this.insertBefore(this.next):this.appendTo(t);n.jQ.remove();n.prev&&n.prev.respace();n.next&&n.next.respace()};t.backspace=function(){if(r(this),this.show(),!this.deleteSelection())if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this};t.deleteForward=function(){if(r(this),this.show(),!this.deleteSelection())if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this};t.selectFrom=function(n){var r=this,u=n,f,e,i,t,s,o;n:for(;;){for(f=this;f!==r.parent.parent;f=f.parent.parent)if(f.parent===u.parent){i=f;t=u;break n}for(e=n;e!==u.parent.parent;e=e.parent.parent)if(r.parent===e.parent){i=r;t=e;break n}r.parent.parent&&(r=r.parent.parent);u.parent.parent&&(u=u.parent.parent)}if(i.next!==t){for(o=i;o;o=o.next)if(o===t.prev){s=!0;break}s||(s=t,t=i,i=s)}this.hide().selection=ni(i.prev.next||i.parent.firstChild,t.next.prev||t.parent.lastChild);this.insertAfter(t.next.prev||t.parent.lastChild);this.root.selectionChanged()};t.selectLeft=function(){if(r(this),this.selection)if(this.selection.first===this.next)this.prev?this.hopLeft().selection.extendLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp();else{if(this.hopLeft(),this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractLeft()}else{if(this.prev)this.hopLeft();else if(this.parent!==this.root)this.insertBefore(this.parent.parent);else return;this.hide().selection=ni(this.next)}this.root.selectionChanged()};t.selectRight=function(){if(r(this),this.selection)if(this.selection.last===this.prev)this.next?this.hopRight().selection.extendRight():this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp();else{if(this.hopRight(),this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractRight()}else{if(this.next)this.hopRight();else if(this.parent!==this.root)this.insertAfter(this.parent.parent);else return;this.hide().selection=ni(this.prev)}this.root.selectionChanged()};t.prepareMove=function(){return r(this),this.show().clearSelection()};t.prepareEdit=function(){return r(this),this.show().deleteSelection()};t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this};t.deleteSelection=function(){return this.selection?(this.prev=this.selection.first.prev,this.next=this.selection.last.next,this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1}}),ni=r(st,function(n,t){n.init=function(){var n=this;t.init.apply(n,arguments);n.jQwrap(n.jQ)};n.jQwrap=function(n){this.jQ=n.wrapAll('<span class="selection"><\/span>').parent()};n.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),t.adopt.apply(this,arguments)};n.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this};n.levelUp=function(){var n=this,t=n.first=n.last=n.last.parent.parent;return n.clear().jQwrap(t.jQ),n};n.extendLeft=function(){this.first=this.first.prev;this.first.jQ.prependTo(this.jQ)};n.extendRight=function(){this.last=this.last.next;this.last.jQ.appendTo(this.jQ)};n.retractRight=function(){this.first.jQ.insertBefore(this.jQ);this.first=this.first.next};n.retractLeft=function(){this.last.jQ.insertAfter(this.jQ);this.last=this.last.prev}});f.fn.mathquill=function(n,t){var i,r;switch(n){case"redraw":return this.each(function(){var n=f(this).attr(a),t=n&&o[n];t&&function i(n){n.eachChild(i);n.redraw&&n.redraw()}(t)});case"revert":return this.each(function(){var t=f(this).attr(a),n=t&&o[t];n&&n.revert&&n.revert()});case"latex":return arguments.length>1?this.each(function(){var n=f(this).attr(a),i=n&&o[n];i&&i.renderLatex(t)}):(i=f(this).attr(a),r=i&&o[i],r&&r.latex());case"text":return i=f(this).attr(a),r=i&&o[i],r&&r.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var n=f(this).attr(a),i=n&&o[n],r=i&&i.cursor;r&&r.writeLatex(t).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var r=f(this).attr(a),u=r&&o[r],n=u&&u.cursor,i;n&&(n.show(),/^\\[a-z]+$/i.test(t)?(i=n.selection,i&&(n.prev=i.first.prev,n.next=i.last.next,delete n.selection),n.insertCmd(t.slice(1),i)):n.insertCh(t),n.hide().parent.blur())});default:var u=n==="textbox",e=u||n==="editable",s=u?oi:ht;return this.each(function(){ri(f(this),s(),u,e)})}};f(function(){f(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable");f(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox");f(".mathquill-embedded-latex").mathquill()})})();
/*
//# sourceMappingURL=mathquill.min.js.map
*/